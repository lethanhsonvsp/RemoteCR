@page "/w"
@rendermode InteractiveServer

@inject RemoteCR.Services.Can.CanStateContainer State
<style>
    .status-dot {
        display: inline-block;
        width: 14px;
        height: 14px;
        border-radius: 50%;
        margin-left: 10px;
    }

        .status-dot.online {
            background-color: #28a745; /* xanh lá */
            box-shadow: 0 0 8px #28a745;
        }

        .status-dot.offline {
            background-color: #dc3545; /* đỏ */
            box-shadow: 0 0 8px #dc3545;
        }

</style>

<h1 class="mb-3 d-flex align-items-center">
    Delta 1kW Wireless Charger

    <span class="status-dot @(State.IsConnected ? "online" : "offline")"></span>

    <small class="ms-2">
        @(State.IsConnected ? "Connected" : "Disconnected")
    </small>
</h1>

<div class="card p-3 mb-3">
    <h4>Electrical</h4>
    <p><b>Voltage:</b> @State.Voltage:F2 V</p>
    <p><b>Current:</b> @State.Current:F2 A</p>
    <p><b>Power:</b> @State.Power:F2 W</p>

    <h4 class="mt-3">Wireless Parameters</h4>
    <p><b>Gap:</b> @State.Gap mm</p>
    <p><b>Primary Temp:</b> @State.PriTemp °C</p>
    <p><b>Secondary Temp:</b> @State.SecTemp °C</p>
</div>

@if (State.Status.Any())
{
    <div class="alert alert-info mt-3">
        <h4>Status</h4>
        <ul>
            @foreach (var s in State.Status)
            {
                <li>@s</li>
            }
        </ul>
    </div>
}

@if (State.Faults.Any())
{
    <div class="alert alert-danger mt-3">
        <h4>Faults</h4>
        <ul>
            @foreach (var f in State.Faults)
            {
                <li>@f</li>
            }
        </ul>
    </div>
}

<div class="card p-3 mt-3">
    <h4>Firmware Versions</h4>
    <p><b>MCU1:</b> @State.RevMCU1</p>
    <p><b>MCU2:</b> @State.RevMCU2</p>
    <p><b>DSP:</b> @State.RevDSP</p>
</div>

@code {
    protected override void OnInitialized()
    {
        State.OnChange += () => InvokeAsync(StateHasChanged);
    }
}
